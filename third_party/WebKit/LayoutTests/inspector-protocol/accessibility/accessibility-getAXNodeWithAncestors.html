<html>
<head>
<script type="text/javascript" src="../../http/tests/inspector-protocol/inspector-protocol-test.js"></script>
<script>

function test()
{
    InspectorTest.sendCommand("DOM.getDocument", {}, onGotDocument);

    function onGotDocument(msg)
    {
        if (msg.error) {
            InspectorTest.log(msg.error.message);
            InspectorTest.completeTest();
            return;
        }
        var rootNode = msg.result.root;
        InspectorTest.sendCommand("DOM.querySelector", { "nodeId": rootNode.nodeId, "selector": "input" }, onQuerySelector);
    }

    function onQuerySelector(msg)
    {
        if (msg.error) {
            InspectorTest.log(msg.error.message);
            InspectorTest.completeTest();
            return;
        }
        var node = msg.result;
        InspectorTest.sendCommand("Accessibility.getAXNodeChain", { "nodeId": node.nodeId, "fetchAncestors": true }, onGotAccessibilityNodes.bind(null, node));
    }

    function onGotAccessibilityNodes(domNode, msg)
    {
        if (msg.error) {
            InspectorTest.log(msg.error.message);
            InspectorTest.completeTest();
            return;
        }

        // nodeId isn't always the same, so set it to a known value if it's present
        if (msg.result && "nodes" in msg.result) {
            for (node of msg.result.nodes) {
                if ("nodeId" in node)
                    node.nodeId = "<id>";
            }
        }

        InspectorTest.log('result: ' + JSON.stringify(msg.result, null, "  "));
        InspectorTest.completeTest();
    }
}

</script>
</head>
<body onLoad="runTest();">
  <div role="main">
    <div role="article" aria-label="Top story">
      <input type="text"></input>
    </div>
  </div>
</body>
</html>
